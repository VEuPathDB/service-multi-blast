digraph {
  graph [nodesep=1]
  node  [margin=0, shape=rect, width=1.3]
  edge  [color=darkblue]

  //
  // Node
  //

  Start        [shape=oval]
  DB           [label="MBlast DB", shape=cylinder, color=purple]
  Refresh      [label="|Refresh\nJob Status|", shape=record]
  IsExpired    [label="Sub-job is\nexpired?", shape=diamond]
  More         [label="More\nsub-jobs\nremaining?", shape=diamond]
  Next         [label="Next\nsub-job"]
  End          [shape=oval]
  Queue        [label="Job queue", shape=component, color=purple]
  Workspace    [label="MBlast\nWorkspaces", shape=cylinder, color=purple]
  NewWorkspace [label="Create\nworkspace"]
  NewQuery     [label="Create\nquery file"]
  Submit       [label="Submit to\nqueue"]

  //
  // Edges
  //

  Start -> More

  More    -> Next      [taillabel="\n           Yes", color=darkgreen]
  End     -> More      [headlabel="No", color=darkred, dir=back]

  Next    -> Refresh

  Refresh   -> IsExpired []
  Refresh   -> DB        [dir=both, style=dotted, color="#333333"]
  Refresh   -> Queue     [dir=both, style=dotted, color="#333333"]

  IsExpired -> NewWorkspace [taillabel="Yes", color=darkgreen]
  IsExpired -> More         [taillabel="No", color=darkred]

  NewWorkspace -> NewQuery
  NewWorkspace -> Workspace [style=dotted, color="#333333"]

  NewQuery -> Submit
  NewQuery -> Workspace [style=dotted, color="#333333"]

  Submit -> More  []
  Submit -> Queue [style=dotted, color="#333333"]


  //
  // Formatting
  //

  {
    rank=same
    End
    More
    Next
  }
}