package mb.api.service.valid

import org.junit.jupiter.api.Assertions.*
import org.junit.jupiter.api.DisplayName
import org.junit.jupiter.api.Nested
import org.junit.jupiter.api.Test

@DisplayName("Sequences")
internal class SequenceTransformerTest {

  @Nested
  @DisplayName("#transform(String)")
  inner class Transform {

    @Test
    @DisplayName("Omits empty lines.")
    fun test1() {
      val input = """> Test header line
Sometextthatmustbe80charactersperlinesoastonotinvalidatethetestbyhavingunrelated


transformationsgoingoninthetransformmethod.Weonlywanttotesttheemptylineremoval.

"""

      val expected = """> Test header line
Sometextthatmustbe80charactersperlinesoastonotinvalidatethetestbyhavingunrelated
transformationsgoingoninthetransformmethod.Weonlywanttotesttheemptylineremoval."""

      assertEquals(expected, Sequences.standardize(input))
    }


    @Test
    @DisplayName("Trims leading margins.")
    fun test2() {
      val input = """> Test header line
        Sometextthatmustbe80charactersperlinesoastonotinvalidatethetestbyhavingunrelated
        transformationsgoingoninthetransformmethod.Weonlywanttotestthemarginremoval.
        """

      val expected = """> Test header line
Sometextthatmustbe80charactersperlinesoastonotinvalidatethetestbyhavingunrelated
transformationsgoingoninthetransformmethod.Weonlywanttotestthemarginremoval."""

      assertEquals(expected, Sequences.standardize(input))
    }

    @Test
    @DisplayName("Breaks/merges lines to 80 character rows.")
    fun test3() {
      val input = """>Test header line
maligkserfsadfvmggaaaivaksaaapiervklllqnqgemiktghlirpy

     tglgncftriyreegvlsfwrgnqan viryfptqasnfafkgyfknllgcskekdgylkwfagnvasgsaagattslflyhldyartrlgtdakecsvngkrqfkg midvyrktlssdgikglyrgfgvsivgitlyrgmyfgmydtikpivlvgslegnflasfllgwsittsagviaypfdtlrrrmmltsgqpvkyrntihalreilksegfyalyrgvtanmllgvagagvlagydqlhqiaykhwvq
"""

      val expected = """>Test header line
maligkserfsadfvmggaaaivaksaaapiervklllqnqgemiktghlirpytglgncftriyreegvlsfwrgnqan
viryfptqasnfafkgyfknllgcskekdgylkwfagnvasgsaagattslflyhldyartrlgtdakecsvngkrqfkg
midvyrktlssdgikglyrgfgvsivgitlyrgmyfgmydtikpivlvgslegnflasfllgwsittsagviaypfdtlr
rrmmltsgqpvkyrntihalreilksegfyalyrgvtanmllgvagagvlagydqlhqiaykhwvq"""

      assertEquals(expected, Sequences.standardize(input))
    }

    @Test
    @DisplayName("Processing an already formatted query.")
    fun test4() {
      val input = """>tr|A0A6G0UYQ7|A0A6G0UYQ7_9BILA Methionine--tRNA ligase, cytoplasmic OS=Halicephalobus sp. NKZ332 OX=2598192 GN=FO519_002674 PE=3 SV=1
PGPQGPPGEQGPAGRDGNPGRQGPRGPPGQNGKDGPPGQDGANGDQGEAGPDGPKGSCDHCPPPRTAPGYMTNPLANWKN
EVEYYDDVVKKLPVPDKRNILITSALPYVNNVPHLGNIIGCVLSGDVFSRYCRIRGYQSIHICGTDEYGTATEMKALKEG
KTPQQICDQFHPLHKTIYEWFNIQFDHFGRTSTQNQTEICQDIFKKLHQNGYTSIESLDQLHCGKCNMFLADRYVGGICP
ICNYDDARGDQCDKCGKLINATELIDPKCSVCSSTPVIKGSKHIFLDLNKLSPKVEEFINKVTSVEGNHWSSNAVSIAKS
WIKTGLEKRCITRDLKWGTPVPLDGFEDKVFYVWFDAPIGYLSITKTLLGDDWEKWWKNPENVELYQFVGKDNVAFHSVI
FPASQIGSEDNYTMVKSLCATEYLNYEDQKFSKSRGTGVFGDAVSDLGIPADVWRFYLIYMRPESQDTAFSWDDFMMKVN
SELLNNLGNFVHRSLTFLFNSFDGTVGEIEFTETEKELVAALDEDIKEFTELLEKVRLRDALTNILSVSRKGNQYMQASK
PWELTKKGPEEKKRAATIISMTANISILLSTMIYPFMPAVSKQIREQCNIEKVIKLPQNMVQFLKPGHKINQPSPLFTKL
EADKIAEWKRKFGSSTGDQANQKPGKAPAGGKKTDQKKNMAGGSKKNTENPLPPEVAELQKKLEVVFKKYENLNANNTAE
ANKVLDELEKNYADLKKLLEVCAASWGKQKVGQLSKENTTLSREVESLVKKLTDLEVASGIKQVSVPERNDGKASQELTP
QKPPTVKSSDETKPAKEKQAKGGNKQTATPQGDDLIDVGRLDLRVGRIVEAKKHPDADALYVETIDFGEGQPRTVVSGLV
KHVSLDQMQNRLVVCLCNLKPAKMRGVESQAMVMCASSPDKVEIMEVDQSAKPGDIVTCEPFAHRPDAQLNPKKKIWEGV
APDLLVSDDGKAVYKGHVLLVNGKTPMTAPTLRNVNSFLKMTKLSKKRAKKMADKIQNDERYKEVSEMPVFNEMKRSERK
IQIDSRFKEMFTDKNFGVGRGDIDMRGRPMGEDQRRGIRDLYDLDSEEESDEEIKLDLARGSGNIYSSDEDSDDTVDTEV
EDSDVEKEAKEKATIWDKLTSDVKHVEWASKRLAICNMDWDNPTSGQLLRLSIYMSDFGKERIEEESKDGPKLKESKKNK
NSKEEGVDDVMRDVLRDYQFERMKYYYAIAEFDSIETATHIYEQCDRMEYESSGIHLDLRFVPEETEFDEEGLKERVDQD
SKQILAQISEKKKSKKADTLSSLPVDTNDERFSALFENPDFAIDKANRKYKGGNLADRQVEVKQERKRKRNELEGKEEKP
EIVDSKALIQKLKMKTKYMMGDHGSTSHDVGNQIWILKQQIESLQHEIGKLHREMGANIVRHNNSFPEVKRRSEETRLRI
LVTGGTGFVGSHLVDKLMEEGHEVIALDNYFTGRKRNVEHWIGHPNFELVHHDVVNPYYIEVDQIYHLASPASPPHYMYN
PVKTIKTNTIGTINLLGLARRVKAKILLASTSEVYGDPEVHPQPESYWGHVNTVGPRSCYDEGKRVAESLMVAYHKQENV
DIRIARIFNTFGPRMHMNDGRVVSNFILQALQSKPITIYGDGNQTRSFQYVSDLVDGLIALMNSNTTLPVNLGNPEEYTI
KDFAVVIRDLVVASQMKKSSQRVDVAKSPLMGPPAKRPFPKPLQAAPGPRRQLQGFVPNQRRYPPVASPIPIQCEESMEE
MKKKVLDLSKENSKHKGEIKFLEVKLSNMENEKRHLKLQWAAKESEKKNLQQEVERMRSQVVFQNETMSFSMMRNQDENL
DLRTEKQGVIKVKVPLLENQRQRKMSGIFTHDDETMEVDPVKHTFQNRFKVPTTSPITNQPRKCSSSVAVQTIAPRESAG
"""

      val expected = """>tr|A0A6G0UYQ7|A0A6G0UYQ7_9BILA Methionine--tRNA ligase, cytoplasmic OS=Halicephalobus sp. NKZ332 OX=2598192 GN=FO519_002674 PE=3 SV=1
PGPQGPPGEQGPAGRDGNPGRQGPRGPPGQNGKDGPPGQDGANGDQGEAGPDGPKGSCDHCPPPRTAPGYMTNPLANWKN
EVEYYDDVVKKLPVPDKRNILITSALPYVNNVPHLGNIIGCVLSGDVFSRYCRIRGYQSIHICGTDEYGTATEMKALKEG
KTPQQICDQFHPLHKTIYEWFNIQFDHFGRTSTQNQTEICQDIFKKLHQNGYTSIESLDQLHCGKCNMFLADRYVGGICP
ICNYDDARGDQCDKCGKLINATELIDPKCSVCSSTPVIKGSKHIFLDLNKLSPKVEEFINKVTSVEGNHWSSNAVSIAKS
WIKTGLEKRCITRDLKWGTPVPLDGFEDKVFYVWFDAPIGYLSITKTLLGDDWEKWWKNPENVELYQFVGKDNVAFHSVI
FPASQIGSEDNYTMVKSLCATEYLNYEDQKFSKSRGTGVFGDAVSDLGIPADVWRFYLIYMRPESQDTAFSWDDFMMKVN
SELLNNLGNFVHRSLTFLFNSFDGTVGEIEFTETEKELVAALDEDIKEFTELLEKVRLRDALTNILSVSRKGNQYMQASK
PWELTKKGPEEKKRAATIISMTANISILLSTMIYPFMPAVSKQIREQCNIEKVIKLPQNMVQFLKPGHKINQPSPLFTKL
EADKIAEWKRKFGSSTGDQANQKPGKAPAGGKKTDQKKNMAGGSKKNTENPLPPEVAELQKKLEVVFKKYENLNANNTAE
ANKVLDELEKNYADLKKLLEVCAASWGKQKVGQLSKENTTLSREVESLVKKLTDLEVASGIKQVSVPERNDGKASQELTP
QKPPTVKSSDETKPAKEKQAKGGNKQTATPQGDDLIDVGRLDLRVGRIVEAKKHPDADALYVETIDFGEGQPRTVVSGLV
KHVSLDQMQNRLVVCLCNLKPAKMRGVESQAMVMCASSPDKVEIMEVDQSAKPGDIVTCEPFAHRPDAQLNPKKKIWEGV
APDLLVSDDGKAVYKGHVLLVNGKTPMTAPTLRNVNSFLKMTKLSKKRAKKMADKIQNDERYKEVSEMPVFNEMKRSERK
IQIDSRFKEMFTDKNFGVGRGDIDMRGRPMGEDQRRGIRDLYDLDSEEESDEEIKLDLARGSGNIYSSDEDSDDTVDTEV
EDSDVEKEAKEKATIWDKLTSDVKHVEWASKRLAICNMDWDNPTSGQLLRLSIYMSDFGKERIEEESKDGPKLKESKKNK
NSKEEGVDDVMRDVLRDYQFERMKYYYAIAEFDSIETATHIYEQCDRMEYESSGIHLDLRFVPEETEFDEEGLKERVDQD
SKQILAQISEKKKSKKADTLSSLPVDTNDERFSALFENPDFAIDKANRKYKGGNLADRQVEVKQERKRKRNELEGKEEKP
EIVDSKALIQKLKMKTKYMMGDHGSTSHDVGNQIWILKQQIESLQHEIGKLHREMGANIVRHNNSFPEVKRRSEETRLRI
LVTGGTGFVGSHLVDKLMEEGHEVIALDNYFTGRKRNVEHWIGHPNFELVHHDVVNPYYIEVDQIYHLASPASPPHYMYN
PVKTIKTNTIGTINLLGLARRVKAKILLASTSEVYGDPEVHPQPESYWGHVNTVGPRSCYDEGKRVAESLMVAYHKQENV
DIRIARIFNTFGPRMHMNDGRVVSNFILQALQSKPITIYGDGNQTRSFQYVSDLVDGLIALMNSNTTLPVNLGNPEEYTI
KDFAVVIRDLVVASQMKKSSQRVDVAKSPLMGPPAKRPFPKPLQAAPGPRRQLQGFVPNQRRYPPVASPIPIQCEESMEE
MKKKVLDLSKENSKHKGEIKFLEVKLSNMENEKRHLKLQWAAKESEKKNLQQEVERMRSQVVFQNETMSFSMMRNQDENL
DLRTEKQGVIKVKVPLLENQRQRKMSGIFTHDDETMEVDPVKHTFQNRFKVPTTSPITNQPRKCSSSVAVQTIAPRESAG"""

      assertEquals(expected, Sequences.standardize(input))
    }

  }
}