#!/usr/bin/env sh

files=$(find docs/schema -type f -name '*.json')

mkdir -p docs/raml

echo "#%RAML 1.0 Library

################################################################################
#                                                                              #
#  DO NOT EDIT THIS FILE; IT WAS GENERATED AUTOMATICALLY.                      #
#  CHANGES MADE HERE WILL BE LOST.                                             #
#                                                                              #
################################################################################

types:" > docs/raml/library.raml

for file in ${files}; do
  name=$(jq -r '.["$id"]' "${file}" | grep -v 'null')

  if [ -z "${name}" ]; then
    continue
  fi

  json-dereference -s "${file}" -o "tmp_.json" > /dev/null
  js2dt "tmp_.json" "${name}" \
    | grep -v '#%\|types:' >> docs/raml/library.raml
  rm "tmp_.json"
done
